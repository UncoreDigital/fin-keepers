---
import propImage from "../../../assets/services/book-keeping/prop.png";
import propImage_2 from "../../../assets/services/book-keeping/prop_2.png";
import cfoImage from "../../../assets/services/book-keeping/cfo.png";
import cfoImage_2 from "../../../assets/services/book-keeping/cfo_2.png";
import salesImage from "../../../assets/services/book-keeping/sales.png";
import salesImage_2 from "../../../assets/services/book-keeping/sales_2.png";
import cashflowImage from "../../../assets/services/book-keeping/cashflow.png";
import cashflowImage_2 from "../../../assets/services/book-keeping/cashflow_2.png";
import inflowImage from "../../../assets/services/book-keeping/inflow.png";
import inflowImage_2 from "../../../assets/services/book-keeping/inflow_2.png";

const tabImages = {
  employee: {
    default: propImage,
    hover: propImage_2,
    alt: "General Accounting",
  },
  commerce: {
    default: cfoImage,
    hover: cfoImage_2,
    alt: "Account Payables and Receivables",
  },
  salary: {
    default: salesImage,
    hover: salesImage_2,
    alt: "Bank Reconciliation",
  },
  state: {
    default: cashflowImage,
    hover: cashflowImage_2,
    alt: "Tax Ready Bookkeeping",
  },
  payroll: {
    default: inflowImage,
    hover: inflowImage_2,
    alt: "Financial Reporting",
  },
};
---

<div class="main-container bg-[#f5f7fa] py-16 px-4 sm:px-6 lg:px-20 mx-auto">
  <div
    class="max-w-screen-xl mx-auto flex flex-col gap-12 sm:gap-16 lg:gap-12 items-center animate-on-scroll opacity-0"
  >
    <!-- Heading -->
    <div
      class="flex flex-col gap-6 sm:gap-8 lg:gap-12 items-start text-left w-full animate-on-scroll-child opacity-0"
    >
      <h2
        class="text-2xl sm:text-3xl lg:text-4xl font-bold leading-tight text-[#04092a] font-['Inter']"
      >
        Smart, Compliant, Stress-Free Payroll for Growing Teams.
      </h2>
      <p
        class="text-base sm:text-lg leading-relaxed text-[#5c667a] font-['Inter']"
        style="max-width: calc(768px + 600px);"
      >
        We manage salaries, compliance, deductions, and employee payouts with accuracy and consistency. Your team gets paid on time, and your payroll stays error-free and compliant.
      </p>
    </div>

    <!-- Tabs -->
    <div
      class="relative w-full overflow-hidden animate-on-scroll-child opacity-0"
    >
      <div
        id="tabsContainer"
        class="hidden sm:flex overflow-x-auto gap-3 px-4 py-4 sm:px-0 sm:py-6 scrollbar-hide scroll-smooth bg-white justify-start sm:justify-center max-w-full mx-auto"
      >
        <button class="tab-button active-tab" data-tab="general"
          >Employee Set Up</button
        >
        <button class="tab-button" data-tab="payables"
          >Tax Withholding & Filing</button
        >
        <button class="tab-button" data-tab="bank">Salary Processing</button>
        <button class="tab-button" data-tab="tax"
          >Multi-State Payroll Support</button
        >
        <button class="tab-button" data-tab="reporting"
          >Scalable Payroll Solutions</button
        >
      </div>
      
      <!-- Mobile swipe tabs ONLY -->
      <div class="tabs-viewport sm:hidden">
        <div class="tabs-list" id="mobileTabs">
          <button class="tab-button active-tab mobile-tab-scroll" data-tab="general">Employee Set Up</button>
          <button class="tab-button mobile-tab-scroll" data-tab="payables">Tax Withholding & Filing</button>
          <button class="tab-button mobile-tab-scroll" data-tab="bank">Salary Processing</button>
          <button class="tab-button mobile-tab-scroll" data-tab="tax">Multi-State Payroll Support</button>
          <button class="tab-button mobile-tab-scroll" data-tab="reporting">Scalable Payroll Solutions</button>
        </div>

        <ul class="tabs-indicators" aria-hidden>
          <li class="indicator active"></li>
          <li class="indicator"></li>
          <li class="indicator"></li>
          <li class="indicator"></li>
          <li class="indicator"></li>
        </ul>
      </div>
    </div>

    <!-- Tab Content (dynamic area) -->
    <div
      id="tabContent"
      class="flex flex-col lg:flex-row gap-6 sm:gap-8 lg:gap-0 justify-center w-full max-w-screen-lg mx-auto animate-on-scroll-child opacity-0"
    >
      <!-- Left -->
      <div
        class="flex flex-col gap-4 sm:gap-6 p-3 sm:p-4 bg-white rounded-lg lg:rounded-r-none w-full lg:w-1/2 flex-grow"
      >
        <div class="flex flex-col gap-3 sm:gap-4 items-start">
          <img
            id="tabIcon"
            src="/img/services/SVG/p1.svg"
            alt="Tab Icon"
            class="w-9 h-9 sm:w-10 sm:h-10 shrink-0"
          />
          <h3
            id="tabTitle"
            class="text-xl sm:text-2xl font-semibold leading-tight text-[#151515]"
          >
            Employee Set Up
          </h3>
        </div>
        <p
          id="tabDescription"
          class="text-base sm:text-lg leading-relaxed text-[#797979]"
        >
          - Even though HR is the one who takes care of the onboarding process,
          the financial onboarding process (opening a bank account for interns,
          asking for tax slips from previous organizations, salary slip
          scrutiny, etc.) is done by Payroll Management. Finkeeper does that
          with precision, and that too within your budget.
        </p>
      </div>

      <!-- Right -->
      <div
        class="flex justify-center items-center p-4 sm:p-6 bg-[#f5f7fa] rounded-lg lg:rounded-l-none w-full lg:w-1/2 flex-grow group"
      >
        <div
          class="relative w-full max-w-[280px] aspect-square overflow-hidden"
        >
          <!-- Default Image -->
          <img
            id="tabImageDefault"
            src={salesImage.src}
            alt="General Accounting"
            class="absolute inset-0 w-full h-full object-contain object-center transition-opacity duration-700 ease-in-out opacity-100 group-hover:opacity-0"
          />
          <!-- Hover Image -->
          <img
            id="tabImageHover"
            src={salesImage_2.src}
            alt="General Accounting Hover"
            class="absolute inset-0 w-full h-full object-contain object-center transition-opacity duration-700 ease-in-out opacity-0 group-hover:opacity-100"
          />
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* MOBILE ONLY */
  @media (max-width: 639px) {
    .tabs-viewport {
      width: 100%;
      overflow: hidden;
    }

    .tabs-list {
      display: flex;
      gap: 12px;
      padding: 12px 16px;
      overflow-x: auto;

      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      touch-action: pan-x;

      scrollbar-width: none;
    }

    .tabs-list::-webkit-scrollbar {
      display: none;
    }

    .tabs-list > .tab-button {
      flex-shrink: 0;
      scroll-snap-align: start;
      white-space: nowrap;
      pointer-events: none; /* Disable clicking on mobile */
      cursor: default;
    }

    .tabs-indicators {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding-top: 8px;
      list-style: none;
    }

    .indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #d1d5db;
    }

    .indicator.active {
      background: #ed7c00;
    }
  }

  /* Tab button styling */
  .tab-button {
    flex-shrink: 0;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    color: #797979;
    border: 1px solid #ccc;
    white-space: nowrap;
    transition: all 0.3s;
  }
  .tab-button.active-tab {
    background: #ed7c00;
    color: #fff;
    font-weight: 600;
    border: none;
  }

  @keyframes fade-up {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-fade-up {
    animation: fade-up 0.8s ease-out forwards;
  }
</style>

<script define:vars={{ tabImages }}>
  // Tabs data
  const tabContentData = {
    general: {
      title: "Employee Set Up",
      description:
        "Even though HR is the one who takes care of the onboarding process, the financial onboarding process (opening a bank account for interns, asking for tax slips from previous organizations, salary slip scrutiny, etc.) is done by Payroll Management. Finkeeper does that with precision, and that too within your budget.",
      icon: "/img/services/SVG/p1.svg",
      images: tabImages.employee,
    },
    payables: {
      title: "Tax Withholding & Filing",
      description:
        "Managing federal, state, and local tax deductions. Filing payroll taxes with the IRS and state authorities. Preparing year-end forms like W-2s and 1099s.",
      icon: "/img/services/SVG/p2.svg",
      images: tabImages.commerce,
    },
    bank: {
      title: "Salary processing",
      description:
        "Salary processing isnâ€™t just about depositing salaries in the accounts of employees. One has to take care of overtime, deductions, tax filing, manage health insurance, retirement plans (401k), and other benefit-related payroll activities, which need legal understanding that might not be the cup of tea for startups and SMEs yet.",
      icon: "/img/services/SVG/p3.svg",
      images: tabImages.salary,
    },
    tax: {
      title: "Multi-State Payroll Support",
      description:
        "Handling payroll for businesses operating across multiple states with varying tax and compliance requirements.",
      icon: "/img/services/SVG/p4.svg",
      images: tabImages.state,
    },
    reporting: {
      title: "Scalable Payroll Solutions",
      description:
        "The Startups and SMEs will not stay limited to 5 employees; they are going to scale and hopefully upscale. During that time, if the payroll services are outsourced to Finkeepers, the higher-ups do not need to worry about how they will manage the staff. It will all be taken care of as we specialize in providing payroll help for small businesses.",
      icon: "/img/services/SVG/p5.svg",
      images: tabImages.payroll,
    },
  };

  // DOM references
  const tabButtons = document.querySelectorAll(".tab-button");
  const tabTitle = document.getElementById("tabTitle");
  const tabDescription = document.getElementById("tabDescription");
  const tabIcon = document.getElementById("tabIcon");
  const tabImageDefault = document.getElementById("tabImageDefault");
  const tabImageHover = document.getElementById("tabImageHover");

  // Check if it's mobile view
  const isMobile = () => window.innerWidth < 640;

  // Switch tab
  function switchTab(tabKey, button) {
    // update buttons
    tabButtons.forEach((btn) => btn.classList.remove("active-tab"));
    button.classList.add("active-tab");

    // update content
    const content = tabContentData[tabKey];
    if (content && tabTitle && tabDescription && tabIcon && tabImageDefault && tabImageHover) {
      tabTitle.textContent = content.title;
      tabDescription.textContent = content.description;
      tabIcon.src = content.icon;
      
       // Update dynamic images
      if (content.images) {
        tabImageDefault.src = content.images.default.src;
        tabImageDefault.alt = content.images.alt;
        tabImageHover.src = content.images.hover.src;
        tabImageHover.alt = content.images.alt;
      }
    }
  }

  // Init - only add click listeners for desktop
  tabButtons.forEach((button) => {
    // Only add click listeners for desktop tabs
    if (!button.classList.contains('mobile-tab-scroll')) {
      button.addEventListener("click", () => {
        const key = button.getAttribute("data-tab");
        if (key) switchTab(key, button);
      });
    }
  });

  // Default first tab
  document.addEventListener("DOMContentLoaded", () => {
    const first = tabButtons[0];
    if (first) {
      const key = first.getAttribute("data-tab");
      switchTab(key, first);
    }
  });

  // Scroll animation observer
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("animate-fade-up");
          entry.target.classList.remove("opacity-0");
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.2 },
  );

  document
    .querySelectorAll(".animate-on-scroll, .animate-on-scroll-child")
    .forEach((el) => observer.observe(el));

  // Mobile-only scroll animation for tab image
  if ('ontouchstart' in window) {
    const tabContainer = document.querySelector('.group');
    const mainImage = document.getElementById('tabImageDefault');
    const hoverImage = document.getElementById('tabImageHover');

    if (tabContainer && mainImage && hoverImage) {
      const tabObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            // Swap images after 1 second
            setTimeout(() => {
              mainImage.style.opacity = '0';
              hoverImage.style.opacity = '1';
              
              // Swap back after 2 seconds
              setTimeout(() => {
                mainImage.style.opacity = '1';
                hoverImage.style.opacity = '0';
              }, 2000);
            }, 1000);
          }
        });
      }, { threshold: 0.5 });

      tabObserver.observe(tabContainer);
    }

    // Mobile scroll-based tab switching (keep original design)
    if (isMobile()) {
      const mobileTabButtons = document.querySelectorAll('.mobile-tab-scroll');
      
      mobileTabButtons.forEach((button, index) => {
        const scrollObserver = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              // Auto-switch to this tab when it comes into view
              setTimeout(() => {
                const tabKey = button.getAttribute('data-tab');
                if (tabKey) {
                  switchTab(tabKey, button);
                  
                  // Update mobile indicators
                  const indicators = document.querySelectorAll('.tabs-indicators .indicator');
                  indicators.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                  });
                }
              }, 300); // Small delay for smooth transition
            }
          });
        }, { 
          threshold: 0.7,
          rootMargin: '-20% 0px -20% 0px'
        });

        scrollObserver.observe(button);
      });
    }
  }

  // Desktop-only click handlers
  const desktopTabButtons = document.querySelectorAll(".tab-button:not(.mobile-tab-scroll)");

  desktopTabButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const key = btn.getAttribute("data-tab");

      // Only update desktop buttons
      desktopTabButtons.forEach(b =>
        b.classList.toggle("active-tab", b.getAttribute("data-tab") === key)
      );

      // Switch tab content
      if (key) switchTab(key, btn);
    });
  });
</script>
